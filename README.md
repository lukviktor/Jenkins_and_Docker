# Jenkins и Docker

## Установка Docker Desktop
Для начала установи Docker Desktop: тогда Docker появится на твоём компьютере.
Зайди на [сайт Docker](https://www.docker.com/products/docker-desktop) и скачай файл для своей ОС.

Чтобы проверить, что всё получилось, введи в командной строке:
``` sh
docker -v
```
Если всё правильно, появится похожая строка с версией Docker:
```Docker version 23.0.5, build bc4487a```
## Создание *docker-compose.yml*
Файл docker-compose.yml помогает развернуть несколько контейнеров так, чтобы они могли общаться друг с другом. Утилита docker-compose использует этот файл, чтобы скачать нужные образы, подготовить инфраструктуру и развернуть контейнеры.
**Проверь, что у тебя есть docker-compose. Введи в командной строке:**
```sh
docker-compose -v
```
Должна появиться строка с версией docker-compose:
```Docker Compose version v2.17.3```

**Создай файл docker-compose.yml**
```
version: '3.7' # версия описания docker-compose.yml
services: # описание сервисов, которые развернутся при запуске файла
  jenkins: # развернётся Jenkins
    image: jenkins/jenkins:lts # образ, который скачается для установки Jenkins
    privileged: true
    user: root
    ports: # порты, которые использует сервис
      - 8081:8080 # В контейнере Jenkins развернётся на порте 8080,
                  # но на локальной машине этот порт часто занят, 
                  # поэтому порт 8080 контейнера связывается
                  # с портом 8081 на локальной машине. 
                  # Получится адрес localhost:8081
    container_name: jenkins # имя контейнера: оно может быть любым
```

**Сохрани файл в любой папке. В командной строке перейди в эту папку и выполни команду:**
```sh
docker-compose up
```
**Теперь docker-compose скачает образ Jenkins и развернёт контейнер.**
Чтобы настроить Jenkins, понадобится пароль. Открой новую вкладку в терминале и выполни команду:
```sh
docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword
```
*Ты получишь пароль такого вида:*
```06fa6035e6ca477aadd197a2d8912889```
**Сохрани этот пароль: он понадобится на следующем шаге.**
## Настройка Jenkins
Тебе удалось развернуть Jenkins. Доступ к нему можно получить по адресу http://localhost:8081/. Если доступа нет, открой страницу в режиме инкогнито.
Вставь в поле `Administrator password пароль`, который тебе удалось получить в консоли, и нажми Continue.
На следующем экране выбери `Install suggested plugins`. Подожди, пока установятся плагины.
*Введи свои данные и кликни `Save and Continue`. Можно не заполнять эту форму: кликнуть `Skip and continue as admin`.*
На следующем экране нажми `Save and Finish`.
**Почти готово! Нажми `Start using Jenkins`.**

## Создание задачи в Jenkins
У тебя открылся Jenkins. 
Чтобы собрать проект, нужно настроить Jenkins: подключить Maven и GitHub.
1. В появившемся окне нажми `Настроить Jenkins`.
2. Выбери `Конфигурация глобальных инструментов`.
3. Найди кнопку `Добавить Maven`. Нажми на неё и заполни поле *«Имя»* любым значением. Нажми Save.
4. Нажми `Создать Item`
5. Введи имя задачи, выбери `Создать задачу со свободной конфигурацией` и нажми OK
6. Найди пункт `Управление исходным кодом`. Заполни поле *Repository URL*: ты можешь вставить ссылку на репозиторий с тестами и файлом `pom.xml`/
**По умолчанию будет выбрана ветка master. Если нужна другая ветка, выбери её — иначе может возникнуть ошибка.**
* В блоке `Credentials` нажми `Add` → `Jenkins`. Впиши свой логин и пароль от GitHub и нажми `Add`.
7. Выбери свой логин и пароль в выпадающем списке.
8. Прокрути вниз до пункта `Сборка`. Нажми `Добавить шаг сборки`. В выпадающем списке выбери `Вызвать цели Maven верхнего уровня`.
9. В поле `Версия Maven` выбери название из пункта 3. В `Цели` напиши test: тогда при каждой сборке проекта будут запускаться все тесты. Нажми `Сохранить`.
10. На следующем экране нажми «Собрать сейчас».
Появится прогресс-бар сборки и тестирования проекта.
Когда сборка закончится, должна появиться зелёная галочка: это значит, что всё прошло успешно.
Можно кликнуть по ней, чтобы просмотреть детальную информацию о сборке.
Например, если нажать на «Вывод консоли», появятся логи. Такие же логи получаются, если собирать и тестировать проект в IDE.
